@page "/deletevacancy/{Id:int}"
@using Stageproject_ATS_AP2025Q2.Services
@using Stageproject_ATS_AP2025Q2.Models
@inject VacancyService VacancyService
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
@rendermode InteractiveServer

<PageTitle>Vacature Verwijderen</PageTitle>
<PageTitle>Delete Vacancy</PageTitle>

<div class="container mx-auto px-4 py-12">
    @if (vacancy == null)
    {
        <div class="flex justify-center items-center h-24">
            <div class="animate-spin rounded-full h-12 w-12 border-t-4 border-blue-600"></div>
        </div>
    }
    else
    {
        <div class="bg-white rounded-2xl shadow-2xl p-10 space-y-8 max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-blue-800">Are you sure you want to delete this vacancy?</h1>
            <p class="text-lg text-gray-800 leading-relaxed">@vacancy.Title</p>

            <p class="text-lg text-gray-800 leading-relaxed">Description:</p>
            <p>@vacancy.Description</p>

            <div class="flex justify-center pt-6">
                <button @onclick="DeleteVacancy"
                        class="px-8 py-3 bg-red-600 text-white font-semibold rounded-full shadow-lg hover:bg-red-700 transition duration-300 ease-in-out transform hover:scale-105">
                    <i class="bi bi-trash3 mr-2"></i> Delete Vacancy
                </button>
                <button @onclick="CancelDelete"
                        class="ml-4 px-8 py-3 bg-gray-600 text-white font-semibold rounded-full shadow-lg hover:bg-gray-700 transition duration-300 ease-in-out transform hover:scale-105">
                    Cancel
                </button>
            </div>
        </div>
    }
</div>


@code {
    [Parameter] public int Id { get; set; } 
    private Vacancy vacancy;

    protected override async Task OnInitializedAsync()
    {
        vacancy = await VacancyService.GetVacancyByIdAsync(Id);
    }

    private async Task DeleteVacancy()
    {
        if (vacancy != null)
        {
            bool isDeleted = await VacancyService.DeleteVacancyAsync(vacancy.Id);
            if (isDeleted)
            {
    await JSRuntime.InvokeVoidAsync("alert", "Vacancy was successfully deleted.");
                NavigationManager.NavigateTo("/vacancies");  
            }
            else
            {
    await JSRuntime.InvokeVoidAsync("alert", "An error occurred while deleting the vacancy.");
            }
        }
    }

    private void CancelDelete()
    {
        NavigationManager.NavigateTo("/vacancies");  
    }
}
